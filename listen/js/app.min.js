function convertSeconds(a){var c,d,e,f,b="0 min";return a>0&&(c=moment.duration(a,"seconds"),e=c.hours(),d=c.days(),e||d?(e+=24*d,e+=" h "):e="",f=c.minutes()||"",!f&&e||(f=c.minutes()+" min"),b=e+f),b}function calculateRatio(a,b){var c;return a&&b?(c=Math.floor(a/b*100),c>100?100:c):0}function errorHandler(a){console.log("error>",a.message)}function linkToDict(a){return"cs"!==to||"en"!==from&&"es"!==from&&"de"!==from&&"fr"!==from&&"it"!==from&&"ru"!==from?"https://translate.google.com/#"+from+"/"+to+"/"+encodeURIComponent(a):"http://slovnik.seznam.cz/"+from+"-cz/word/?q="+encodeURIComponent(a)}function prependPrevWord(a){$previous_translated_words.prepend('<p><a target="_blank" href="'+linkToDict(a[from])+'"><span>'+a[from]+"</span>&nbsp;&nbsp;"+a[to]+" <em>></em></a></p>")}function mycallback(a){$translatedword.text(a)}function callBing(a,b,c){$.ajax({type:"POST",data:{authtype:"js"},url:server+"token.php",success:function(d){var e=document.createElement("script");e.src="https://api.microsofttranslator.com/V2/Ajax.svc/Translate?appId=Bearer "+encodeURIComponent(d)+"&from="+encodeURIComponent(a)+"&to="+encodeURIComponent(b)+"&text="+encodeURIComponent(c)+"&oncomplete=mycallback",document.body.appendChild(e)},error:function(a,b){$translatedword.text("ERROR")}})}function getTextSelection(){return window.getSelection?window.getSelection().toString():document.getSelection?document.getSelection().toString():document.selection?document.selection.createRange().text:""}function onCopyEvent(){handleSelectedText(getTextSelection())}function handleSelectedText(a){if(!a||previous_selection===a)return!1;previous_selection=a;var b={};return b[from]=$selectedword.text(),b[to]=$translatedword.text(),a=a.trim(),a.split(" ").length<=1?($translatedword.text("..."),a=a.replace(/^[¿¡(„‚“‘'"‹›«»—-]+|[,.:;?!)“”‘’'"‹›«»—-]+$/g,""),$whentoolong.addClass("hidden"),$selectedword.text(a),callBing(from,to,a),$translations.removeClass("hidden"),$linktodict.attr("href",linkToDict(a))):($googletranslate.attr("href","https://translate.google.com/#"+from+"/"+to+"/"+encodeURIComponent(a)),$translations.addClass("hidden"),$whentoolong.removeClass("hidden"),$translatedword.text("...")),$previous_translated_words.is(":visible")&&"..."!==b[to]&&"ERROR"!==b[to]&&prependPrevWord(b),!0}function setProgressBar(){var a=player.currentTime/player.duration*100||0;qS_progress.style.width=a+"%"}function loadAudioToPlayer(a){player=new Audio(a),$audioFileSelect.css({"background-color":"#f9f9f9"});var b=0;player.oncanplay=function(){b||($play_pause.css("color","#4ba3d9"),player.duration?(player.currentTime=stored_audio_time,setProgressBar()):correct_progress_bar=1,stored_volume?(player.volume=stored_volume,$vol_value.width(100*stored_volume+"%")):$vol_value.width("100%"),b=1)};var c=0,d=stored_audio_time;player.ontimeupdate=function(){0===player.currentTime&&stored_audio_time&&(player.currentTime=stored_audio_time+c),setProgressBar(),c=player.currentTime-d,d=player.currentTime,TRACK.addAudioTime(c)},player.onended=function(){$pause_btn.addClass("hidden"),$play_btn.removeClass("hidden")}}function resetPlayer(){!player||player.paused||player.ended||player.pause(),stored_audio_time=0,localStorage.setItem("stored_audio_time",stored_audio_time),audiofile=0,localStorage.removeItem("stored_audio_file_url"),$pause_btn.addClass("hidden"),$play_btn.removeClass("hidden"),qS_progress.style.width="0%",$play_pause.css("color","#AEAEAE"),$audioFileSelect.css({"background-color":"#ffffff"})}function resetText(){$backhome.addClass("hidden"),$content.addClass("hidden").text(""),$instructions.removeClass("hidden"),scrollposition=0,localStorage.setItem("scrollposition",scrollposition),localStorage.removeItem("stored_text_file_content"),$textFileSelect.css({"background-color":"#ffffff"}),noParams()}function handleAudioFileSelect(a){resetPlayer(),noParams(),audiofile=a.target.files[0],loadAudioToPlayer(URL.createObjectURL(audiofile));var b=function(a){return"audio"===a.type.substring(0,5)&&"mp3"===a.name.substr(a.name.length-3)};if(audiofile.size<103809024&&b(audiofile)){var c=new FormData($("form")[0]);uploaded_file_id&&c.append("previous",uploaded_file_id),$.ajax({url:server+"upload.php",type:"POST",success:function(a){"Sorry"!==a.substring(0,5)&&(a=$.trim(a),localStorage.setItem("uploaded_file_id",a),localStorage.setItem("stored_audio_file_url",server+"uploads/"+a+".mp3"))},error:function(a){console.log("error: ",a)},data:c,cache:!1,contentType:!1,processData:!1})}}function loadText(a){$instructions.addClass("hidden"),$textFileSelect.css({"background-color":"#f9f9f9"});for(var b=a.split("\n"),c='<p><span class="mycontent"> ',d=0,e=b.length;d<e;d++)"\r"!==b[d]&&""!==b[d]?c=c+b[d]+" ":c+='</span></p><p><span class="mycontent"> ';c+="</span></p>",$backhome.removeClass("hidden"),$content.removeClass("hidden").html(c),$content_wrapper.scrollTop(scrollposition),$content_wrapper.scroll(function(){localStorage.setItem("scrollposition",this.scrollTop)})}function handleTextFileSelect(a){if("txt"===a.target.files[0].name.substr(a.target.files[0].name.length-3)&&"text"===a.target.files[0].type.substring(0,4))if(scrollposition=0,localStorage.setItem("scrollposition",scrollposition),window.FileReader){var b=new FileReader;b.onload=function(a){loadText(a.target.result),localStorage.setItem("stored_text_file_content",a.target.result)},b.readAsText(a.target.files[0])}else console.log("File reader not supported.");else console.log("This is not a text file!")}function loadDemo(a,b){$instructions.addClass("hidden"),resetPlayer(),$.get("../demo/"+a+".txt",function(a){loadText(a)}),audiofile="https://www.simplyeasy.cz/understand-server/files/"+a+".mp3",loadAudioToPlayer(audiofile),$from.val(b),$from.change()}function jumpBack(a){var b=player.currentTime;b>a?(player.currentTime=b-a,stored_audio_time=player.currentTime,localStorage.setItem("stored_audio_time",stored_audio_time)):(player.currentTime=0,stored_audio_time=0,localStorage.setItem("stored_audio_time",stored_audio_time))}function playPause(){stored_audio_time=player.currentTime,correct_progress_bar&&setTimeout(function(){player.duration&&(setProgressBar(),correct_progress_bar=0)},200),player.paused||player.ended?(player.play(),$play_btn.addClass("hidden"),$pause_btn.removeClass("hidden"),TRACK.addPauseTime(),document.getElementById("idle").style.color="#4ba3d9"):(player.pause(),$pause_btn.addClass("hidden"),$play_btn.removeClass("hidden"),localStorage.setItem("stored_audio_time",stored_audio_time),TRACK.startPauseTimer(),TRACK.storeTrackingData())}function controlsToBottom(){var a=0,b=$(window).height(),c=$lowerthan600px.is(":visible"),d=$previous_translated_words.is(":visible"),e=$widerthan725px.is(":visible");d?(a=b-158,c&&(a+=65)):e?a=b-140:(a=b-228,c&&(a+=80)),a&&$content_wrapper.css({height:a+"px"})}function getQueryVariable(a,b){for(var c=a.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(e[0]==b)return e[1]}return!1}function noParams(){window.location.search.substring(1)&&history.replaceState({},"understand",location.href.split("?")[0])}var server="https://www.simplyeasy.cz/understand-server/",player=0,from=localStorage.getItem("stored_lang_from")||"es",to=localStorage.getItem("stored_lang_to")||"en",scrollposition=Number(localStorage.getItem("scrollposition"))||0,textfile=localStorage.getItem("stored_text_file_content")||0,audiofile=localStorage.getItem("stored_audio_file_url")||0,stored_audio_time=Number(localStorage.getItem("stored_audio_time"))||0,stored_volume=Number(localStorage.getItem("stored_volume"))||0,uploaded_file_id=localStorage.getItem("uploaded_file_id")||0,correct_progress_bar=0,$body,$audio_time,$session_time,$ratio,$session_audio_ratio,$audio_time_total,$session_time_total,$i_am_done,$backhome,$higher_than_ever,$translatedword,$selectedword,$translations,$whentoolong,$play_btn,$pause_btn,$play_pause,$jumpback,$from,$to,$idle,$goal_today,$streak,$record_ratio,$previous_translated_words,$linktodict,$googletranslate,$textFileSelect,$audioFileSelect,$content,$content_wrapper,$instructions,$tracking,$video,$videocover,$videoafter,$videoreplay,$listened,$progressbar,qS_progress,$volbar,$vol_value,$vol,$vol_on,$vol_off,ui_loc={en:{day:"day",days:"days"},cs:{day:"den",days:"dnů"}},today=moment().format("YYYY-MM-DD"),allowed_idle=3e5,last_pause_time,pause_diff,data=JSON.parse(localStorage.getItem("data"))||{},TRACK={};TRACK.dataObjectExist=function(a){data[from]||(data[from]={total:{st:0,at:0,dg:1800,s:0,rr:0},days:{}}),data[from].days[a]||(data[from].days[a]={at:0,st:0,ga:0})},TRACK.displayDailyGoal=function(){$goal_today.text(convertSeconds(data[from].total.dg))},TRACK.displayTrackingData=function(a){$audio_time.text(convertSeconds(data[from].days[a].at));var b=convertSeconds(data[from].days[a].st);$session_time.text(b);var c=calculateRatio(data[from].days[a].st,data[from].total.dg);$listened.height(1.5*c+"px");var d=calculateRatio(data[from].days[a].at,data[from].days[a].st);$session_audio_ratio.text(d),$ratio.height(c*d*.015+"px"),$audio_time_total.text(convertSeconds(data[from].total.at)),$session_time_total.text(convertSeconds(data[from].total.st)),data[from].days[a].ga?data[from].total.rr&&d>data[from].total.rr?$higher_than_ever.removeClass("hidden"):$higher_than_ever.addClass("hidden"):data[from].days[a].st>data[from].total.dg&&($i_am_done.removeClass("hidden"),$idle.html('<i class="fa fa-check-circle"></i>'),data[from].days[a].ga=1,TRACK.currentStreak())},TRACK.currentStreak=function(){var a=moment(today).subtract(1,"days").format("YYYY-MM-DD");"added"!==data[from].days[today].ga&&(data[from].days[today].ga?(data[from].days[a]&&data[from].days[a].ga?data[from].total.s=data[from].total.s+data[from].days[today].ga:data[from].total.s=1,data[from].days[today].ga="added",TRACK.storeTrackingData()):data[from].days[a]&&data[from].days[a].ga||(data[from].total.s=0)),1===data[from].total.s?$streak.text(data[from].total.s+" "+ui_loc[ui_lang].day):$streak.text(data[from].total.s+" "+ui_loc[ui_lang].days)},TRACK.ratioStats=function(){var a,b;for(a=1;a<31;a++)b=moment(today).subtract(a,"days").format("YYYY-MM-DD")||0,data[from].days[b]&&data[from].days[b].ga&&(data[from].days[b].r||(data[from].days[b].r=calculateRatio(data[from].days[b].at,data[from].days[b].st)),data[from].days[b].r>data[from].total.rr&&(data[from].total.rr=data[from].days[b].r));data[from].total.rr&&$record_ratio.text(data[from].total.rr+"%")},TRACK.storeTrackingData=function(){localStorage.setItem("data",JSON.stringify(data))},TRACK.addToDayAndTotal=function(a,b){data[from].days[today][b]=data[from].days[today][b]+a,data[from].total[b]=data[from].total[b]+a},deleteTrackingData=function(){localStorage.removeItem("data"),document.getElementById("delete").innerHTML="[ deleted ]"},TRACK.addAudioTime=function(a){a>-7&&a<1&&(a>0?(TRACK.addToDayAndTotal(a,"st"),TRACK.addToDayAndTotal(a,"at")):a&&data[from].days[today].at+a>0&&(TRACK.addToDayAndTotal(a,"at"),TRACK.displayTrackingData(today)))},TRACK.startPauseTimer=function(){last_pause_time=moment()},TRACK.addPauseTime=function(){last_pause_time&&(pause_diff=moment().diff(last_pause_time),pause_diff<allowed_idle&&TRACK.addToDayAndTotal(pause_diff/1e3,"st"))},TRACK.newDay=function(){today!==moment().format("YYYY-MM-DD")&&(today=moment().format("YYYY-MM-DD"),TRACK.dataObjectExist(today),$i_am_done.addClass("hidden"),$idle.html('<i class="fa fa-clock-o"></i>'),$higher_than_ever.addClass("hidden"),last_pause_time=0,TRACK.ratioStats(),TRACK.displayTrackingData(today),TRACK.currentStreak())};var previous_selection="";$(document).ready(function(){$body=$("html, body"),$audio_time=$("#audio_time"),$session_time=$("#session_time"),$ratio=$("#ratio"),$session_audio_ratio=$("#session_audio_ratio"),$audio_time_total=$("#audio_time_total"),$session_time_total=$("#session_time_total"),$i_am_done=$("#i_am_done"),$idle=$("#idle"),$higher_than_ever=$("#higher_than_ever"),$translatedword=$("#translatedword"),$selectedword=$("#selectedword"),$translations=$("#translations"),$whentoolong=$("#whentoolong"),$play_btn=$("#play_btn"),$pause_btn=$("#pause_btn"),$play_pause=$("#play_pause"),$jumpback=$("#jumpback"),$from=$("#from"),$to=$("#to"),$backhome=$("#backhome"),$goal_today=$("#goal_today"),$streak=$("#streak"),$record_ratio=$("#record_ratio"),$previous_translated_words=$("#previous_translated_words"),$linktodict=$("#linktodict"),$googletranslate=$("#googletranslate"),$textFileSelect=$("#textFileSelect"),$audioFileSelect=$("#audioFileSelect"),$content=$("#content"),$content_wrapper=$("#content_wrapper"),$instructions=$("#instructions"),$tracking=$("#tracking"),$video=$("#video"),$videocover=$("#videocover"),$videoafter=$("#videoafter"),$videoreplay=$("#videoreplay"),$listened=$("#listened"),$progressbar=$("#progressbar"),qS_progress=document.querySelector("#progress"),$volbar=$("#volbar"),$vol_value=$("#vol_value"),$vol=$("#vol"),$vol_on=$("#vol_on"),$vol_off=$("#vol_off"),$widerthan725px=$("#widerthan725px"),$lowerthan600px=$("#lowerthan600px"),controlsToBottom(),window.addEventListener("orientationchange",function(){setTimeout(controlsToBottom,400)},!1);var a=$jumpback.data("jump");textfile?loadText(textfile):($instructions.removeClass("hidden"),$backhome.addClass("hidden")),$content.on("mouseup",function(a){var b=window.getSelection(),c=b.getRangeAt(0);if(0===b.toString().length&&$(a.target).is("span.mycontent")){for(var d=b.anchorNode;0!==c.toString().indexOf(" ");)c.setStart(d,c.startOffset-1);if(c.setStart(d,c.startOffset+1),c.endOffset<d.length){do c.setEnd(d,c.endOffset+1);while(c.toString().indexOf(" ")===-1);c.setEnd(d,c.endOffset-1)}}var e=c.toString().trim();handleSelectedText(e)}),document.getElementById("content").addEventListener("copy",onCopyEvent),localStorage.getItem("stored_lang_to")||(to=ui_lang,$to.val(to),localStorage.getItem("stored_lang_from")||"en"===to||(from="en",$from.val("en"))),$from.val(from),$to.val(to),$from.change(function(){from=$(this).val(),TRACK.dataObjectExist(today),TRACK.displayDailyGoal(),TRACK.displayTrackingData(today),localStorage.setItem("stored_lang_from",from)}),$to.change(function(){to=$(this).val(),localStorage.setItem("stored_lang_to",to)}),$play_pause.click(function(){audiofile?playPause():$videocover.is(":visible")&&($body.animate({scrollTop:"0px"},300),$videocover.click())}),$jumpback.click(function(){jumpBack(a)});var b=document.getElementById("audio_files");b.addEventListener("change",handleAudioFileSelect,!1);var c=document.getElementById("audioFileSelect");c.addEventListener("click",function(a){b&&b.click(),a.preventDefault()},!1);var d=document.getElementById("text_files");d.addEventListener("change",handleTextFileSelect,!1);var e=document.getElementById("textFileSelect");e.addEventListener("click",function(a){d&&d.click(),a.preventDefault()},!1),audiofile&&loadAudioToPlayer(audiofile),$backhome.click(function(){resetPlayer(),resetText()}),$progressbar.click(function(a){if(player){var b=a.offsetX/$(this).width();player.currentTime=b*player.duration,qS_progress.style.width=100*b+"%"}}),$volbar.click(function(a){player&&(player.volume=a.offsetX/80,$vol_value.width(100*player.volume+"%"),localStorage.setItem("stored_volume",player.volume))});var f=1;$vol.click(function(){player&&$vol_on.is(":visible")?(f=player.volume,player.volume=0,$vol_value.width("0"),$vol_on.addClass("hidden"),$vol_off.removeClass("hidden")):player&&$vol_off.is(":visible")&&(player.volume=f,$vol_value.width(100*f+"%"),$vol_off.addClass("hidden"),$vol_on.removeClass("hidden"))});var g=window.location.search.substring(1);if(g){var h=getQueryVariable(g,"id"),i=getQueryVariable(g,"lang");h&&i&&loadDemo(h,i)}window.onkeyup=function(b){var c=b.keyCode?b.keyCode:b.which;37==c?jumpBack(a):39==c?audiofile&&playPause():16!=c||b.ctrlKey||b.metaKey||($googletranslate.is(":visible")?$googletranslate[0].click():$selectedword.text()&&$linktodict[0].click())};var j=$("#r").text();j=j.replace(" at ",String.fromCharCode(64)),j=j.replace(" dot ",String.fromCharCode(46)),$("#r").text(j),$(".jump_to").click(function(){var a=$(this).data("marker");$body.animate({scrollTop:$("#"+a).offset().top},1e3)}),TRACK.dataObjectExist(today),TRACK.displayDailyGoal(),TRACK.displayTrackingData(today),data[from].days[today].ga&&($i_am_done.removeClass("hidden"),$idle.html('<i class="fa fa-check-circle"></i>')),TRACK.currentStreak(),TRACK.ratioStats();setInterval(function(){player.paused||player.ended?(last_pause_time&&moment().diff(last_pause_time)>allowed_idle&&(document.getElementById("idle").style.color="#d7d7d7"),TRACK.newDay()):TRACK.displayTrackingData(today)},1e3);$("#minus").click(function(){data[from].total.dg>900&&(data[from].total.dg=data[from].total.dg-900,TRACK.displayDailyGoal(),TRACK.displayTrackingData(today),TRACK.storeTrackingData())}),$("#plus").click(function(){data[from].total.dg=data[from].total.dg+900,TRACK.displayDailyGoal(),TRACK.displayTrackingData(today),TRACK.storeTrackingData()});var l=document.getElementById("videofile");$video.click(function(){$videocover.addClass("hidden"),l.paused||l.ended?l.play():l.pause(),l.addEventListener("ended",function(){$videoafter.removeClass("hidden")})}),$videoreplay.click(function(){$videoafter.addClass("hidden")}),function(a,b,c,d,e,f){a.hj=a.hj||function(){(a.hj.q=a.hj.q||[]).push(arguments)},a._hjSettings={hjid:79605,hjsv:5},e=b.getElementsByTagName("head")[0],f=b.createElement("script"),f.async=1,f.src=c+a._hjSettings.hjid+d+a._hjSettings.hjsv,e.appendChild(f)}(window,document,"//static.hotjar.com/c/hotjar-",".js?sv=")});