var server="https://www.simplyeasy.cz/understand-server/",from=localStorage.getItem("stored_lang_from")||"es",to=localStorage.getItem("stored_lang_to")||"en",scrollposition=Number(localStorage.getItem("scrollposition"))||0,textfile=localStorage.getItem("stored_text_file_content")||0,audiofile=localStorage.getItem("stored_audio_file_url")||0,player=0,stored_audio_time=Number(localStorage.getItem("stored_audio_time"))||0,uploaded_file_id=localStorage.getItem("uploaded_file_id")||0,correct_knob_duration=
0,ui_loc={en:{day:"day",days:"days"},cs:{day:"den",days:"dn\u016f"}},today=moment().format("YYYY-MM-DD"),allowed_idle=3E5,last_pause_time,pause_diff,data=JSON.parse(localStorage.getItem("data"))||{};function convertSeconds(a){var b="0 min",c;if(0<a){a=moment.duration(a,"seconds");(b=a.hours()||"")&&(b+=" h ");if((c=a.minutes()||"")||!b)c=a.minutes()+" min";b+=c}return b}function calculateRatio(a,b){return a&&b?Math.floor(a/b*100):"-"}
var TRACK={dataObjectExist:function(a){data[from]||(data[from]={total:{st:0,at:0,dg:1800,s:0,rr:0},days:{}});data[from].days[a]||(data[from].days[a]={at:0,st:0,ga:0})},setTodayKnob:function(){$("#goal_today").text(convertSeconds(data[from].total.dg));$("#knob_today").trigger("configure",{max:data[from].total.dg}).val(data[from].days[today].st).trigger("change")},displayTrackingData:function(a){$("#audio_time").text(convertSeconds(data[from].days[a].at));$(".session_time").text(convertSeconds(data[from].days[a].st));
var b=calculateRatio(data[from].days[a].at,data[from].days[a].st);0<b?($("#session_audio_ratio").text(b),$("#ratio").height(1.7*b),$("#ratio").removeClass("hidden")):$("#ratio").addClass("hidden");$("#audio_time_total").text(convertSeconds(data[from].total.at));$("#session_time_total").text(convertSeconds(data[from].total.st));$("#knob_today").val(data[from].days[a].st).trigger("change");data[from].days[a].ga?data[from].total.rr&&b>data[from].total.rr?$("#higher_than_ever").removeClass("hidden"):
$("#higher_than_ever").addClass("hidden"):data[from].days[a].st>data[from].total.dg&&($("#i_am_done").removeClass("hidden"),$("#idle").html('<i class="fa fa-check-circle"></i>'),data[from].days[a].ga=1,TRACK.currentStreak())},currentStreak:function(){var a=moment(today).subtract(1,"days").format("YYYY-MM-DD");"added"!==data[from].days[today].ga&&(data[from].days[today].ga?(data[from].total.s=data[from].days[a]&&data[from].days[a].ga?data[from].total.s+data[from].days[today].ga:1,data[from].days[today].ga=
"added",TRACK.storeTrackingData()):data[from].days[a]&&data[from].days[a].ga||(data[from].total.s=0));1===data[from].total.s?$("#streak").text(data[from].total.s+" "+ui_loc[ui_lang].day):$("#streak").text(data[from].total.s+" "+ui_loc[ui_lang].days)},ratioStats:function(){data[from].total.rr=data[from].total.rr||0;var a,b;for(a=1;31>a;a++)b=moment(today).subtract(a,"days").format("YYYY-MM-DD")||0,data[from].days[b]&&data[from].days[b].ga&&(data[from].days[b].r||(data[from].days[b].r=calculateRatio(data[from].days[b].at,
data[from].days[b].st)),data[from].days[b].r>data[from].total.rr&&(data[from].total.rr=data[from].days[b].r));data[from].total.rr&&$("#record_ratio").text(data[from].total.rr+"%")},storeTrackingData:function(){localStorage.setItem("data",JSON.stringify(data))},addToDayAndTotal:function(a,b){data[from].days[today][b]+=a;data[from].total[b]+=a}};deleteTrackingData=function(){localStorage.removeItem("data");document.getElementById("delete").innerHTML="<br /><br />[ deleted ]"};
TRACK.addAudioTime=function(a){-7<a&&1>a&&(0<a?(TRACK.addToDayAndTotal(a,"st"),TRACK.addToDayAndTotal(a,"at")):a&&0<data[from].days[today].at+a&&(TRACK.addToDayAndTotal(a,"at"),TRACK.displayTrackingData(today)))};TRACK.startPauseTimer=function(){last_pause_time=moment()};TRACK.addPauseTime=function(){last_pause_time&&(pause_diff=moment().diff(last_pause_time),pause_diff<allowed_idle&&TRACK.addToDayAndTotal(pause_diff/1E3,"st"))};
TRACK.newDay=function(){today!==moment().format("YYYY-MM-DD")&&(today=moment().format("YYYY-MM-DD"),TRACK.dataObjectExist(today),$("#i_am_done").addClass("hidden"),$("#idle").html('<i class="fa fa-clock-o"></i>'),$("#ratio").addClass("hidden"),$("#higher_than_ever").addClass("hidden"),last_pause_time=0,TRACK.ratioStats(),TRACK.displayTrackingData(today),TRACK.currentStreak())};function errorHandler(a){console.log("error>",a.message)}
function linkToDict(a){return"cs"!==to||"en"!==from&&"es"!==from&&"de"!==from&&"fr"!==from&&"it"!==from&&"ru"!==from?"https://translate.google.com/#"+from+"/"+to+"/"+encodeURIComponent(a):"http://slovnik.seznam.cz/"+from+"-cz/word/?q="+encodeURIComponent(a)}function prependPrevWord(a){$("#previous_translated_words").prepend('<p><a target="_blank" href="'+linkToDict(a[from])+'"><span>'+a[from]+"</span>&nbsp;&nbsp;"+a[to]+" <em>></em></a></p>")}function mycallback(a){$("#translatedword").text(a)}
function callBing(a,b,c){$.ajax({type:"POST",data:{authtype:"js"},url:server+"token.php",success:function(d){var e=document.createElement("script");e.src="https://api.microsofttranslator.com/V2/Ajax.svc/Translate?appId=Bearer "+encodeURIComponent(d)+"&from="+encodeURIComponent(a)+"&to="+encodeURIComponent(b)+"&text="+encodeURIComponent(c)+"&oncomplete=mycallback";document.body.appendChild(e)},error:function(a,b){console.log("bing translator error");$("#translatedword").text("UNTRANSLATED")}})}
function getTextSelection(){return window.getSelection?window.getSelection().toString():document.getSelection?document.getSelection().toString():document.selection?document.selection.createRange().text:""}function onCopyEvent(){handleSelectedText(getTextSelection())}
function handleSelectedText(a){var b={};b[from]=$("#selectedword").text();b[to]=$("#translatedword").text();""!==a&&" "!==a&&a!==b[from]&&($("#translatedword").text("..."),a=a.trim(),1>=a.split(" ").length?($("#whentoolong").addClass("hidden"),a=a.replace(/[,.?\u00bf!\u00a1:();\u201e\u201c\u201d\u201a\u2018\u2019"\u2039\u203a\u00ab\u00bb\u2014]/g,""),$("#selectedword").text(a),callBing(from,to,a),$("#translations").removeClass("hidden"),$("#linktodict").attr("href",linkToDict(a))):($("#googletranslate").attr("href",
"https://translate.google.com/#"+from+"/"+to+"/"+encodeURIComponent(a)),$("#whentoolong").removeClass("hidden"),$("#translations").addClass("hidden")),""!==b[from]&&"..."!==b[to]&&$("#previous_translated_words_wrapper").is(":visible")&&prependPrevWord(b))}function setKnob(a,b){var c=b||stored_audio_time;$("#knob_player").trigger("configure",{max:a}).val(c).trigger("change")}
function loadAudioToPlayer(a){player=new Audio(a);$("#audioFileSelect").css({"background-color":"#FFFFFF",color:"#565656"});var b=0;player.oncanplay=function(){b||($("#play_pause").css("color","#4ba3d9"),player.duration?(player.currentTime=stored_audio_time,setKnob(player.duration,stored_audio_time)):correct_knob_duration=1,b=1)};var c=0,d=stored_audio_time;player.ontimeupdate=function(){0===player.currentTime&&stored_audio_time&&(player.currentTime=stored_audio_time+c);$("#knob_player").val(player.currentTime).trigger("change");
c=player.currentTime-d;d=player.currentTime;TRACK.addAudioTime(c)};player.onended=function(){$("#pause_btn").addClass("hidden");$("#play_btn").removeClass("hidden")}}
function resetPlayer(){!player||player.paused||player.ended||player.pause();stored_audio_time=0;localStorage.setItem("stored_audio_time",stored_audio_time);audiofile=0;localStorage.removeItem("stored_audio_file_url");$("#pause_btn").addClass("hidden");$("#play_btn").removeClass("hidden");$("#knob_player").val(0).trigger("change");$("#play_pause").css("color","#AEAEAE");$("#audioFileSelect").css({"background-color":"#4ba3d9",color:"#ffffff"})}
function resetText(){$(".backhome").addClass("hidden");$("#content").addClass("hidden").text("");$("#instructions").removeClass("hidden");scrollposition=0;localStorage.setItem("scrollposition",scrollposition);localStorage.removeItem("stored_text_file_content");$("#textFileSelect").css({"background-color":"#4ba3d9",color:"#ffffff"})}
function handleAudioFileSelect(a){resetPlayer();audiofile=a.target.files[0];loadAudioToPlayer(URL.createObjectURL(audiofile));a=function(a){return"audio"===a.type.substring(0,5)&&"mp3"===a.name.substr(a.name.length-3)?!0:!1};103809024>audiofile.size&&a(audiofile)&&(a=new FormData($("form")[0]),uploaded_file_id&&a.append("previous",uploaded_file_id),$.ajax({url:server+"upload.php",type:"POST",success:function(a){"Sorry"!==a.substring(0,5)&&(a=$.trim(a),localStorage.setItem("uploaded_file_id",a),localStorage.setItem("stored_audio_file_url",
server+"uploads/"+a+".mp3"))},error:function(a){console.log("error: ",a)},data:a,cache:!1,contentType:!1,processData:!1}))}
function loadText(a){$("#textFileSelect").css({"background-color":"#FFFFFF",color:"#565656"});a=a.split("\n");for(var b='<p><span class="mycontent"> ',c=0,d=a.length;c<d;c++)b="\r"!==a[c]&&""!==a[c]?b+a[c]+" ":b+'</span></p><p><span class="mycontent"> ';b+="</span></p>";$("#instructions").addClass("hidden");$(".backhome").removeClass("hidden");$("#content").removeClass("hidden").html(b);$("#content_wrapper").scrollTop(scrollposition);$("#content_wrapper").scroll(function(){localStorage.setItem("scrollposition",
this.scrollTop)})}
function handleTextFileSelect(a){if("txt"===a.target.files[0].name.substr(a.target.files[0].name.length-3)&&"text"===a.target.files[0].type.substring(0,4))if(scrollposition=0,localStorage.setItem("scrollposition",scrollposition),window.FileReader){var b=new FileReader;b.onload=function(a){loadText(a.target.result);localStorage.setItem("stored_text_file_content",a.target.result)};b.readAsText(a.target.files[0])}else console.log("File reader not supported.");else console.log("This is not a text file!")}
function loadDemo(a){resetPlayer();$.get("../demo/"+a+".txt",function(a){loadText(a);localStorage.setItem("stored_text_file_content",a)});audiofile="https://www.simplyeasy.cz/understand-server/files/"+a+".mp3";loadAudioToPlayer(audiofile);localStorage.setItem("stored_audio_file_url",audiofile)}
function jumpBack(a){var b=player.currentTime;b>a?(player.currentTime=b-a,stored_audio_time=player.currentTime):stored_audio_time=player.currentTime=0;localStorage.setItem("stored_audio_time",stored_audio_time)}
function playPause(){stored_audio_time=player.currentTime;correct_knob_duration&&setTimeout(function(){player.duration&&(setKnob(player.duration,stored_audio_time),correct_knob_duration=0)},200);player.paused||player.ended?(player.play(),$("#play_btn").addClass("hidden"),$("#pause_btn").removeClass("hidden"),TRACK.addPauseTime(),document.getElementById("idle").style.color="#4ba3d9"):(player.pause(),$("#pause_btn").addClass("hidden"),$("#play_btn").removeClass("hidden"),localStorage.setItem("stored_audio_time",
stored_audio_time),TRACK.startPauseTimer(),TRACK.storeTrackingData())}function controlsToBottom(){var a=0,a=$(window).height(),a=1100>=$(window).width()?a-238:a-168;400<a&&$("#content_wrapper").css({height:a+"px"})}
$(document).ready(function(){controlsToBottom();window.addEventListener("orientationchange",function(){setTimeout(controlsToBottom,400)},!1);var a=$("#jumpback").data("jump");textfile?loadText(textfile):($("#instructions").removeClass("hidden"),$(".backhome").addClass("hidden"));$("#content").on("click","span.mycontent",function(a){s=window.getSelection();a=s.getRangeAt(0);for(var b=s.anchorNode;0!==a.toString().indexOf(" ");)a.setStart(b,a.startOffset-1);a.setStart(b,a.startOffset+1);if(a.endOffset<
b.length){do a.setEnd(b,a.endOffset+1);while(-1===a.toString().indexOf(" ")&&""!==a.toString().trim())}a=a.toString().trim();handleSelectedText(a)});document.getElementById("content").addEventListener("copy",onCopyEvent);localStorage.getItem("stored_lang_to")||(to=ui_lang,$("#to").val(to),localStorage.getItem("stored_lang_from")||"en"===to||(from="en",$("#from").val("en")));$("#from").val(from);$("#to").val(to);$("#from").change(function(){from=$(this).val();TRACK.dataObjectExist(today);TRACK.setTodayKnob();
TRACK.displayTrackingData(today);loadAd();localStorage.setItem("stored_lang_from",from)});$("#to").change(function(){to=$(this).val();loadAd();localStorage.setItem("stored_lang_to",to)});$(".knob").knob({change:function(a){player.currentTime=a}});$("#knob_player").trigger("configure",{max:100}).val(0).trigger("change");$("#play_pause").click(function(){audiofile&&playPause()});$("#jumpback").click(function(){jumpBack(a)});var b=document.getElementById("audio_files");b.addEventListener("change",handleAudioFileSelect,
!1);document.getElementById("audioFileSelect").addEventListener("click",function(a){b&&b.click();a.preventDefault()},!1);var c=document.getElementById("text_files");c.addEventListener("change",handleTextFileSelect,!1);document.getElementById("textFileSelect").addEventListener("click",function(a){c&&c.click();a.preventDefault()},!1);audiofile&&loadAudioToPlayer(audiofile);$(".backhome").click(function(){resetPlayer();resetText()});$(".demo").click(function(){$("#more").addClass("hidden");$("html, body").scrollTop(0);
loadDemo($(this).attr("id"));$("#from").val($(this).parent().data("lang"));$("#from").change()});$("#tryitnow").click(function(){$("#more").removeClass("hidden");$("html, body").scrollTop(0)});$(".overlay").click(function(){$(".hidepopup").addClass("hidden");$("html, body").scrollTop(0)});$(".closepopup").click(function(){$(".hidepopup").addClass("hidden");$("html, body").scrollTop(0)});$("#show_video").click(function(){$("#video").removeClass("hidden");$("html, body").scrollTop(0)});window.onkeyup=
function(b){b=b.keyCode?b.keyCode:b.which;37==b?jumpBack(a):39==b&&playPause()};var d=$("#r").text(),d=d.replace(" at ",String.fromCharCode(64)),d=d.replace(" dot ",String.fromCharCode(46));$("#r").text(d);$(".jump_to").click(function(){var a=$(this).data("marker");$("html, body").animate({scrollTop:$("#"+a).offset().top},1E3)});TRACK.dataObjectExist(today);TRACK.setTodayKnob();TRACK.displayTrackingData(today);data[from].days[today].ga&&($("#i_am_done").removeClass("hidden"),$("#idle").html('<i class="fa fa-check-circle"></i>'));
TRACK.currentStreak();TRACK.ratioStats();setInterval(function(){player.paused||player.ended?(last_pause_time&&moment().diff(last_pause_time)>allowed_idle&&(document.getElementById("idle").style.color="#d7d7d7"),TRACK.newDay()):TRACK.displayTrackingData(today)},1E3);$("#idle").click(function(){$("html, body").animate({scrollTop:$("#tracking")[0].scrollHeight+($("#tracking").offset().top-$(window).height())})});$("#minus").click(function(){900<data[from].total.dg&&(data[from].total.dg-=900,TRACK.setTodayKnob(),
TRACK.storeTrackingData())});$("#plus").click(function(){data[from].total.dg+=900;TRACK.setTodayKnob();TRACK.storeTrackingData()})});