function convertSeconds(e){var t,a,o,r,d="0 min";return e>0&&(t=moment.duration(e,"seconds"),o=t.hours(),a=t.days(),o||a?(o+=24*a,o+=" h "):o="",r=t.minutes()||"",(r||!o)&&(r=t.minutes()+" min"),d=o+r),d}function calculateRatio(e,t){var a;return e&&t?(a=Math.floor(e/t*100),a>100?100:a):0}function errorHandler(e){console.log("error>",e.message)}function linkToDict(e){return"cs"!==to||"en"!==from&&"es"!==from&&"de"!==from&&"fr"!==from&&"it"!==from&&"ru"!==from?"https://translate.google.com/#"+from+"/"+to+"/"+encodeURIComponent(e):"http://slovnik.seznam.cz/"+from+"-cz/word/?q="+encodeURIComponent(e)}function prependPrevWord(e){$previous_translated_words.prepend('<p><a target="_blank" href="'+linkToDict(e[from])+'"><span>'+e[from]+"</span>&nbsp;&nbsp;"+e[to]+" <em>></em></a></p>")}function mycallback(e){$translatedword.text(e)}function callBing(e,t,a){$.ajax({type:"POST",data:{authtype:"js"},url:server+"token.php",success:function(o){var r=document.createElement("script");r.src="https://api.microsofttranslator.com/V2/Ajax.svc/Translate?appId=Bearer "+encodeURIComponent(o)+"&from="+encodeURIComponent(e)+"&to="+encodeURIComponent(t)+"&text="+encodeURIComponent(a)+"&oncomplete=mycallback",document.body.appendChild(r)},error:function(e,t){$translatedword.text("ERROR")}})}function getTextSelection(){return window.getSelection?window.getSelection().toString():document.getSelection?document.getSelection().toString():document.selection?document.selection.createRange().text:""}function onCopyEvent(){handleSelectedText(getTextSelection())}function handleSelectedText(e){if(!e||previous_selection===e)return!1;previous_selection=e;var t={};return t[from]=$selectedword.text(),t[to]=$translatedword.text(),e=e.trim(),e.split(" ").length<=1?($translatedword.text("..."),e=e.replace(/^[¿¡(„‚“‘'"‹›«»—-]+|[,.:;?!)“”‘’'"‹›«»—-]+$/g,""),$whentoolong.addClass("hidden"),$selectedword.text(e),callBing(from,to,e),$translations.removeClass("hidden"),$linktodict.attr("href",linkToDict(e))):($googletranslate.attr("href","https://translate.google.com/#"+from+"/"+to+"/"+encodeURIComponent(e)),$translations.addClass("hidden"),$whentoolong.removeClass("hidden"),$translatedword.text("...")),$previous_translated_words.is(":visible")&&"..."!==t[to]&&"ERROR"!==t[to]&&prependPrevWord(t),!0}function setProgressBar(){var e=player.currentTime/player.duration*100||0;$progress.width(e+"%")}function loadAudioToPlayer(e){player=new Audio(e),$audioFileSelect.css({"background-color":"#f9f9f9"});var t=0;player.oncanplay=function(){t||($play_pause.css("color","#4ba3d9"),player.duration?(player.currentTime=stored_audio_time,setProgressBar()):correct_progress_bar=1,t=1)};var a=0,o=stored_audio_time;player.ontimeupdate=function(){0===player.currentTime&&stored_audio_time&&(player.currentTime=stored_audio_time+a),setProgressBar(),a=player.currentTime-o,o=player.currentTime,TRACK.addAudioTime(a)},player.onended=function(){$pause_btn.addClass("hidden"),$play_btn.removeClass("hidden")}}function resetPlayer(){!player||player.paused||player.ended||player.pause(),stored_audio_time=0,localStorage.setItem("stored_audio_time",stored_audio_time),audiofile=0,localStorage.removeItem("stored_audio_file_url"),$pause_btn.addClass("hidden"),$play_btn.removeClass("hidden"),$progress.width("0%"),$play_pause.css("color","#AEAEAE"),$audioFileSelect.css({"background-color":"#ffffff"})}function resetText(){$backhome.addClass("hidden"),$content.addClass("hidden").text(""),$instructions.removeClass("hidden"),scrollposition=0,localStorage.setItem("scrollposition",scrollposition),localStorage.removeItem("stored_text_file_content"),$textFileSelect.css({"background-color":"#ffffff"}),noParams()}function handleAudioFileSelect(e){resetPlayer(),noParams(),audiofile=e.target.files[0],loadAudioToPlayer(URL.createObjectURL(audiofile));var t=function(e){return"audio"===e.type.substring(0,5)&&"mp3"===e.name.substr(e.name.length-3)?!0:!1};if(audiofile.size<103809024&&t(audiofile)){var a=new FormData($("form")[0]);uploaded_file_id&&a.append("previous",uploaded_file_id),$.ajax({url:server+"upload.php",type:"POST",success:function(e){"Sorry"!==e.substring(0,5)&&(e=$.trim(e),localStorage.setItem("uploaded_file_id",e),localStorage.setItem("stored_audio_file_url",server+"uploads/"+e+".mp3"))},error:function(e){console.log("error: ",e)},data:a,cache:!1,contentType:!1,processData:!1})}}function loadText(e){$instructions.addClass("hidden"),$textFileSelect.css({"background-color":"#f9f9f9"});for(var t=e.split("\n"),a='<p><span class="mycontent"> ',o=0,r=t.length;r>o;o++)"\r"!==t[o]&&""!==t[o]?a=a+t[o]+" ":a+='</span></p><p><span class="mycontent"> ';a+="</span></p>",$backhome.removeClass("hidden"),$content.removeClass("hidden").html(a),$content_wrapper.scrollTop(scrollposition),$content_wrapper.scroll(function(){localStorage.setItem("scrollposition",this.scrollTop)})}function handleTextFileSelect(e){if("txt"===e.target.files[0].name.substr(e.target.files[0].name.length-3)&&"text"===e.target.files[0].type.substring(0,4))if(scrollposition=0,localStorage.setItem("scrollposition",scrollposition),window.FileReader){var t=new FileReader;t.onload=function(e){loadText(e.target.result),localStorage.setItem("stored_text_file_content",e.target.result)},t.readAsText(e.target.files[0])}else console.log("File reader not supported.");else console.log("This is not a text file!")}function loadDemo(e,t){$instructions.addClass("hidden"),resetPlayer(),$.get("../demo/"+e+".txt",function(e){loadText(e)}),audiofile="https://www.simplyeasy.cz/understand-server/files/"+e+".mp3",loadAudioToPlayer(audiofile),$from.val(t),$from.change()}function jumpBack(e){var t=player.currentTime;t>e?(player.currentTime=t-e,stored_audio_time=player.currentTime,localStorage.setItem("stored_audio_time",stored_audio_time)):(player.currentTime=0,stored_audio_time=0,localStorage.setItem("stored_audio_time",stored_audio_time))}function playPause(){stored_audio_time=player.currentTime,correct_progress_bar&&setTimeout(function(){player.duration&&(setProgressBar(),correct_progress_bar=0)},200),player.paused||player.ended?(player.play(),$play_btn.addClass("hidden"),$pause_btn.removeClass("hidden"),TRACK.addPauseTime(),document.getElementById("idle").style.color="#4ba3d9"):(player.pause(),$pause_btn.addClass("hidden"),$play_btn.removeClass("hidden"),localStorage.setItem("stored_audio_time",stored_audio_time),TRACK.startPauseTimer(),TRACK.storeTrackingData())}function recordReplay(){2===recording_state?$recording.click():$playback.click()}function controlsToBottom(){var e=0,t=$(window).height(),a=$lowerthan600px.is(":visible"),o=$previous_translated_words.is(":visible"),r=$widerthan725px.is(":visible");o?(e=t-158,a&&(e+=65)):r?e=t-140:(e=t-228,a&&(e+=80)),e&&$content_wrapper.css({height:e+"px"})}function getQueryVariable(e,t){for(var a=e.split("&"),o=0;o<a.length;o++){var r=a[o].split("=");if(r[0]==t)return r[1]}return!1}function noParams(){window.location.search.substring(1)&&history.replaceState({},"understand",location.href.split("?")[0])}var server="https://www.simplyeasy.cz/understand-server/",from=localStorage.getItem("stored_lang_from")||"es",to=localStorage.getItem("stored_lang_to")||"en",scrollposition=Number(localStorage.getItem("scrollposition"))||0,textfile=localStorage.getItem("stored_text_file_content")||0,audiofile=localStorage.getItem("stored_audio_file_url")||0,player=0,stored_audio_time=Number(localStorage.getItem("stored_audio_time"))||0,uploaded_file_id=localStorage.getItem("uploaded_file_id")||0,correct_progress_bar=0,$body,$audio_time,$session_time,$ratio,$session_audio_ratio,$audio_time_total,$session_time_total,$i_am_done,$backhome,$higher_than_ever,$translatedword,$selectedword,$translations,$whentoolong,$play_btn,$pause_btn,$play_pause,$jumpback,$from,$to,$idle,$goal_today,$streak,$record_ratio,$previous_translated_words,$linktodict,$googletranslate,$textFileSelect,$audioFileSelect,$content,$content_wrapper,$instructions,$tracking,$video,$videocover,$videoafter,$videoreplay,$listened,$progress,$playback,$recording,ui_loc={en:{day:"day",days:"days"},cs:{day:"den",days:"dnů"}},today=moment().format("YYYY-MM-DD"),allowed_idle=3e5,last_pause_time,pause_diff,subtract_from_pause_time=0,paused_updating_tracking_charts=0,data=JSON.parse(localStorage.getItem("data"))||{},TRACK={};TRACK.dataObjectExist=function(e){data[from]||(data[from]={total:{st:0,at:0,dg:1800,s:0,rr:0},days:{}}),data[from].days[e]||(data[from].days[e]={at:0,st:0,ga:0})},TRACK.displayDailyGoal=function(){$goal_today.text(convertSeconds(data[from].total.dg))},TRACK.displayTrackingData=function(e){if(!paused_updating_tracking_charts){$audio_time.text(convertSeconds(data[from].days[e].at));var t=convertSeconds(data[from].days[e].st);$session_time.text(t);var a=calculateRatio(data[from].days[e].st,data[from].total.dg);$listened.height(1.5*a+"px");var o=calculateRatio(data[from].days[e].at,data[from].days[e].st);$session_audio_ratio.text(o),$ratio.height(a*o*.015+"px"),$audio_time_total.text(convertSeconds(data[from].total.at)),$session_time_total.text(convertSeconds(data[from].total.st)),data[from].days[e].ga?data[from].total.rr&&o>data[from].total.rr?$higher_than_ever.removeClass("hidden"):$higher_than_ever.addClass("hidden"):data[from].days[e].st>data[from].total.dg&&($i_am_done.removeClass("hidden"),$idle.html('<i class="fa fa-check-circle"></i>'),data[from].days[e].ga=1,TRACK.currentStreak())}},TRACK.currentStreak=function(){var e=moment(today).subtract(1,"days").format("YYYY-MM-DD");"added"!==data[from].days[today].ga&&(data[from].days[today].ga?(data[from].days[e]&&data[from].days[e].ga?data[from].total.s=data[from].total.s+data[from].days[today].ga:data[from].total.s=1,data[from].days[today].ga="added",TRACK.storeTrackingData()):data[from].days[e]&&data[from].days[e].ga||(data[from].total.s=0)),1===data[from].total.s?$streak.text(data[from].total.s+" "+ui_loc[ui_lang].day):$streak.text(data[from].total.s+" "+ui_loc[ui_lang].days)},TRACK.ratioStats=function(){var e,t;for(e=1;31>e;e++)t=moment(today).subtract(e,"days").format("YYYY-MM-DD")||0,data[from].days[t]&&data[from].days[t].ga&&(data[from].days[t].r||(data[from].days[t].r=calculateRatio(data[from].days[t].at,data[from].days[t].st)),data[from].days[t].r>data[from].total.rr&&(data[from].total.rr=data[from].days[t].r));data[from].total.rr&&$record_ratio.text(data[from].total.rr+"%")},TRACK.storeTrackingData=function(){localStorage.setItem("data",JSON.stringify(data))},TRACK.addToDayAndTotal=function(e,t){data[from].days[today][t]=data[from].days[today][t]+e,data[from].total[t]=data[from].total[t]+e},deleteTrackingData=function(){localStorage.removeItem("data"),document.getElementById("delete").innerHTML="[ deleted ]"},TRACK.addAudioTime=function(e){e>-7&&1>e&&(e>0?(TRACK.addToDayAndTotal(e,"st"),TRACK.addToDayAndTotal(e,"at")):e&&data[from].days[today].at+e>0&&(TRACK.addToDayAndTotal(e,"at"),TRACK.displayTrackingData(today)))},TRACK.startPauseTimer=function(){last_pause_time=moment()},TRACK.addPauseTime=function(){last_pause_time&&(pause_diff=moment().diff(last_pause_time),subtract_from_pause_time=0,allowed_idle>pause_diff&&TRACK.addToDayAndTotal(pause_diff/1e3,"st"))},TRACK.newDay=function(){today!==moment().format("YYYY-MM-DD")&&(today=moment().format("YYYY-MM-DD"),TRACK.dataObjectExist(today),$i_am_done.addClass("hidden"),$idle.html('<i class="fa fa-clock-o"></i>'),$higher_than_ever.addClass("hidden"),last_pause_time=0,TRACK.ratioStats(),TRACK.displayTrackingData(today),TRACK.currentStreak())};var previous_selection="",recording_state=2;$(document).ready(function(){$body=$("html, body"),$audio_time=$("#audio_time"),$session_time=$("#session_time"),$ratio=$("#ratio"),$session_audio_ratio=$("#session_audio_ratio"),$audio_time_total=$("#audio_time_total"),$session_time_total=$("#session_time_total"),$i_am_done=$("#i_am_done"),$idle=$("#idle"),$higher_than_ever=$("#higher_than_ever"),$translatedword=$("#translatedword"),$selectedword=$("#selectedword"),$translations=$("#translations"),$whentoolong=$("#whentoolong"),$play_btn=$("#play_btn"),$pause_btn=$("#pause_btn"),$play_pause=$("#play_pause"),$jumpback=$("#jumpback"),$from=$("#from"),$to=$("#to"),$backhome=$("#backhome"),$goal_today=$("#goal_today"),$streak=$("#streak"),$record_ratio=$("#record_ratio"),$previous_translated_words=$("#previous_translated_words"),$linktodict=$("#linktodict"),$googletranslate=$("#googletranslate"),$textFileSelect=$("#textFileSelect"),$audioFileSelect=$("#audioFileSelect"),$content=$("#content"),$content_wrapper=$("#content_wrapper"),$instructions=$("#instructions"),$tracking=$("#tracking"),$video=$("#video"),$videocover=$("#videocover"),$videoafter=$("#videoafter"),$videoreplay=$("#videoreplay"),$listened=$("#listened"),$progress=$("#progress"),$playback=$("#playback"),$recording=$("#recording"),$widerthan725px=$("#widerthan725px"),$lowerthan600px=$("#lowerthan600px"),controlsToBottom(),window.addEventListener("orientationchange",function(){setTimeout(controlsToBottom,400)},!1);var e=$jumpback.data("jump");textfile?loadText(textfile):($instructions.removeClass("hidden"),$backhome.addClass("hidden")),$content.on("mouseup",function(e){var t=window.getSelection(),a=t.getRangeAt(0);if(0===t.toString().length&&$(e.target).is("span.mycontent")){for(var o=t.anchorNode;0!==a.toString().indexOf(" ");)a.setStart(o,a.startOffset-1);if(a.setStart(o,a.startOffset+1),a.endOffset<o.length){do a.setEnd(o,a.endOffset+1);while(-1===a.toString().indexOf(" "));a.setEnd(o,a.endOffset-1)}}var r=a.toString().trim();handleSelectedText(r)}),document.getElementById("content").addEventListener("copy",onCopyEvent),localStorage.getItem("stored_lang_to")||(to=ui_lang,$to.val(to),localStorage.getItem("stored_lang_from")||"en"===to||(from="en",$from.val("en"))),$from.val(from),$to.val(to),$from.change(function(){from=$(this).val(),TRACK.dataObjectExist(today),TRACK.displayDailyGoal(),TRACK.displayTrackingData(today),localStorage.setItem("stored_lang_from",from)}),$to.change(function(){to=$(this).val(),localStorage.setItem("stored_lang_to",to)}),$play_pause.click(function(){audiofile?playPause():$videocover.is(":visible")&&($body.animate({scrollTop:"0px"},300),$videocover.click())}),$jumpback.click(function(){jumpBack(e)});var t=document.getElementById("audio_files");t.addEventListener("change",handleAudioFileSelect,!1);var a=document.getElementById("audioFileSelect");a.addEventListener("click",function(e){t&&t.click(),e.preventDefault()},!1);var o=document.getElementById("text_files");o.addEventListener("change",handleTextFileSelect,!1);var r=document.getElementById("textFileSelect");r.addEventListener("click",function(e){o&&o.click(),e.preventDefault()},!1),audiofile&&loadAudioToPlayer(audiofile),$backhome.click(function(){resetPlayer(),resetText()});var d=window.location.search.substring(1);if(d){var i=getQueryVariable(d,"id"),n=getQueryVariable(d,"lang");i&&n&&loadDemo(i,n)}if(window.onkeyup=function(t){var a=t.keyCode?t.keyCode:t.which;37==a?jumpBack(e):39==a?audiofile&&playPause():13!=a||$(".helpcrunch-chat").is(":visible")||$("select").is(":focus")?16!=a||t.ctrlKey||t.metaKey||$(".helpcrunch-chat").is(":visible")||($googletranslate.is(":visible")?$googletranslate[0].click():$selectedword.text()&&$linktodict[0].click()):recordReplay()},!("ontouchstart"in window)&&window.AudioContext||window.webkitAudioContext){var s,l=document.getElementById("rec");l.onended=function(){$playback.removeClass("active"),recording_state=2,subtract_from_pause_time=2e3*l.duration,s&&(isNaN(l.duration)||(paused_updating_tracking_charts=1,jumpBack(l.duration),l.duration>7&&TRACK.addToDayAndTotal(-l.duration,"at"),TRACK.addToDayAndTotal(-l.duration,"st"),setTimeout(function(){paused_updating_tracking_charts=0},1e3*l.duration)),player.paused&&playPause(),s=0)},$recording.on("click",function(){$playback.hasClass("active")||(!player.currentTime||player.paused||player.ended||(playPause(),s=1),$recording.hasClass("active")?(Fr.voice.stop(),$recording.removeClass("active")):Fr.voice.record(!1,function(){$playback.removeClass("active"),$recording.addClass("active"),recording_state=0}))}),$playback.on("click",function(){$playback.hasClass("active")?(l.pause(),$playback.removeClass("active")):($recording.hasClass("active")&&(Fr.voice.stop(),$recording.removeClass("active")),$playback.addClass("active"),recording_state&&l.duration?l.play():Fr.voice.replay(function(e){l.src=e,l.onloadedmetadata=function(){l.play(),recording_state=1}},"URL"))})}else $(".rec").css({color:"#c4c4c4","background-color":"transparent"}).click(function(){alert("Audio recording does not work in this browser :-(")});var c=$("#r").text();c=c.replace(" at ",String.fromCharCode(64)),c=c.replace(" dot ",String.fromCharCode(46)),$("#r").text(c),$(".jump_to").click(function(){var e=$(this).data("marker");$body.animate({scrollTop:$("#"+e).offset().top},1e3)}),TRACK.dataObjectExist(today),TRACK.displayDailyGoal(),TRACK.displayTrackingData(today),data[from].days[today].ga&&($i_am_done.removeClass("hidden"),$idle.html('<i class="fa fa-check-circle"></i>')),TRACK.currentStreak(),TRACK.ratioStats();setInterval(function(){player.paused||player.ended?(last_pause_time&&moment().diff(last_pause_time)>allowed_idle&&(document.getElementById("idle").style.color="#d7d7d7"),TRACK.newDay()):TRACK.displayTrackingData(today)},1e3);$("#minus").click(function(){data[from].total.dg>900&&(data[from].total.dg=data[from].total.dg-900,TRACK.displayDailyGoal(),TRACK.displayTrackingData(today),TRACK.storeTrackingData())}),$("#plus").click(function(){data[from].total.dg=data[from].total.dg+900,TRACK.displayDailyGoal(),TRACK.displayTrackingData(today),TRACK.storeTrackingData()});var u=document.getElementById("videofile");$video.click(function(){$videocover.addClass("hidden"),u.paused||u.ended?u.play():u.pause(),u.addEventListener("ended",function(){$videoafter.removeClass("hidden")})}),$videoreplay.click(function(){$videoafter.addClass("hidden"),$videocover.click()}),function(e,t,a,o,r,d){e.hj=e.hj||function(){(e.hj.q=e.hj.q||[]).push(arguments)},e._hjSettings={hjid:79605,hjsv:5},r=t.getElementsByTagName("head")[0],d=t.createElement("script"),d.async=1,d.src=a+e._hjSettings.hjid+o+e._hjSettings.hjsv,r.appendChild(d)}(window,document,"//static.hotjar.com/c/hotjar-",".js?sv=");var m={applicationId:117,applicationSecret:"kIpJ1ACkWUz2f8fR1drIfrTBRX1jVZRMdjSDmkPX+x8hciZvIvflfGXFa8zfg8D9aoHTPGDCsD0+F9V8I2xRiQ=="};uploaded_file_id&&(m.user={user_id:uploaded_file_id}),function(e,t){e.HelpCrunch=function(){e.HelpCrunch.q.push(arguments)},e.HelpCrunch.q=[];var a=document.createElement("script");a.async=1,a.type="text/javascript",a.src="https://honzzz.helpcrunch.com/compiled/sdk.js",t.body.appendChild(a)}(window,document),HelpCrunch("init","honzzz",m),HelpCrunch("showChatWidget",{position:"right"})});