function convertSeconds(e){var t,a,o,r,n="0 min";return e>0&&(t=moment.duration(e,"seconds"),o=t.hours(),a=t.days(),o||a?(o+=24*a,o+=" h "):o="",r=t.minutes()||"",(r||!o)&&(r=t.minutes()+" min"),n=o+r),n}function calculateRatio(e,t){return e&&t?Math.floor(e/t*100):"-"}function errorHandler(e){console.log("error>",e.message)}function linkToDict(e){return"cs"!==to||"en"!==from&&"es"!==from&&"de"!==from&&"fr"!==from&&"it"!==from&&"ru"!==from?"https://translate.google.com/#"+from+"/"+to+"/"+encodeURIComponent(e):"http://slovnik.seznam.cz/"+from+"-cz/word/?q="+encodeURIComponent(e)}function prependPrevWord(e){$previous_translated_words.prepend('<p><a target="_blank" href="'+linkToDict(e[from])+'"><span>'+e[from]+"</span>&nbsp;&nbsp;"+e[to]+" <em>></em></a></p>")}function mycallback(e){$translatedword.text(e)}function callBing(e,t,a){$.ajax({type:"POST",data:{authtype:"js"},url:server+"token.php",success:function(o){var r=document.createElement("script");r.src="https://api.microsofttranslator.com/V2/Ajax.svc/Translate?appId=Bearer "+encodeURIComponent(o)+"&from="+encodeURIComponent(e)+"&to="+encodeURIComponent(t)+"&text="+encodeURIComponent(a)+"&oncomplete=mycallback",document.body.appendChild(r)},error:function(){console.log("bing translator error"),$translatedword.text("ERROR")}})}function getTextSelection(){return window.getSelection?window.getSelection().toString():document.getSelection?document.getSelection().toString():document.selection?document.selection.createRange().text:""}function onCopyEvent(){handleSelectedText(getTextSelection())}function handleSelectedText(e){if(!e||previous_selection===e)return!1;previous_selection=e;var t={};return t[from]=$selectedword.text(),t[to]=$translatedword.text(),e=e.trim(),e.split(" ").length<=1?($translatedword.text("..."),e=e.replace(/^[,.?¿!¡:();„“”‚‘'’"‹›«»-—]+|[,.?¿!¡:();„“”‚‘'’"‹›«»-—]+$/g,""),$whentoolong.addClass("hidden"),$selectedword.text(e),callBing(from,to,e),$translations.removeClass("hidden"),$linktodict.attr("href",linkToDict(e))):($googletranslate.attr("href","https://translate.google.com/#"+from+"/"+to+"/"+encodeURIComponent(e)),$translations.addClass("hidden"),$whentoolong.removeClass("hidden"),$translatedword.text("...")),$previous_translated_words.is(":visible")&&"..."!==t[to]&&"ERROR"!==t[to]&&prependPrevWord(t),!0}function setKnob(e,t){var a=t||stored_audio_time;$knob_player.trigger("configure",{max:e}).val(a).trigger("change")}function loadAudioToPlayer(e){player=new Audio(e),$audioFileSelect.css({"background-color":"#f9f9f9"});var t=0;player.oncanplay=function(){t||($play_pause.css("color","#4ba3d9"),player.duration?(player.currentTime=stored_audio_time,setKnob(player.duration,stored_audio_time)):correct_knob_duration=1,t=1)};var a=0,o=stored_audio_time;player.ontimeupdate=function(){0===player.currentTime&&stored_audio_time&&(player.currentTime=stored_audio_time+a),$knob_player.val(player.currentTime).trigger("change"),a=player.currentTime-o,o=player.currentTime,TRACK.addAudioTime(a)},player.onended=function(){$pause_btn.addClass("hidden"),$play_btn.removeClass("hidden")}}function resetPlayer(){!player||player.paused||player.ended||player.pause(),stored_audio_time=0,localStorage.setItem("stored_audio_time",stored_audio_time),audiofile=0,localStorage.removeItem("stored_audio_file_url"),$pause_btn.addClass("hidden"),$play_btn.removeClass("hidden"),$knob_player.val(0).trigger("change"),$play_pause.css("color","#AEAEAE"),$audioFileSelect.css({"background-color":"#ffffff"})}function resetText(){$backhome.addClass("hidden"),$content.addClass("hidden").text(""),$instructions.removeClass("hidden"),scrollposition=0,localStorage.setItem("scrollposition",scrollposition),localStorage.removeItem("stored_text_file_content"),$textFileSelect.css({"background-color":"#ffffff"}),noParams()}function handleAudioFileSelect(e){resetPlayer(),noParams(),audiofile=e.target.files[0],loadAudioToPlayer(URL.createObjectURL(audiofile));var t=function(e){return"audio"===e.type.substring(0,5)&&"mp3"===e.name.substr(e.name.length-3)?!0:!1};if(audiofile.size<103809024&&t(audiofile)){var a=new FormData($("form")[0]);uploaded_file_id&&a.append("previous",uploaded_file_id),$.ajax({url:server+"upload.php",type:"POST",success:function(e){"Sorry"!==e.substring(0,5)&&(e=$.trim(e),localStorage.setItem("uploaded_file_id",e),localStorage.setItem("stored_audio_file_url",server+"uploads/"+e+".mp3"))},error:function(e){console.log("error: ",e)},data:a,cache:!1,contentType:!1,processData:!1})}}function loadText(e){$instructions.addClass("hidden"),$textFileSelect.css({"background-color":"#f9f9f9"});for(var t=e.split("\n"),a='<p><span class="mycontent"> ',o=0,r=t.length;r>o;o++)"\r"!==t[o]&&""!==t[o]?a=a+t[o]+" ":a+='</span></p><p><span class="mycontent"> ';a+="</span></p>",$backhome.removeClass("hidden"),$content.removeClass("hidden").html(a),$content_wrapper.scrollTop(scrollposition),$content_wrapper.scroll(function(){localStorage.setItem("scrollposition",this.scrollTop)})}function handleTextFileSelect(e){if("txt"===e.target.files[0].name.substr(e.target.files[0].name.length-3)&&"text"===e.target.files[0].type.substring(0,4))if(scrollposition=0,localStorage.setItem("scrollposition",scrollposition),window.FileReader){var t=new FileReader;t.onload=function(e){loadText(e.target.result),localStorage.setItem("stored_text_file_content",e.target.result)},t.readAsText(e.target.files[0])}else console.log("File reader not supported.");else console.log("This is not a text file!")}function loadDemo(e,t){$instructions.addClass("hidden"),resetPlayer(),$.get("../demo/"+e+".txt",function(e){loadText(e)}),audiofile="https://www.simplyeasy.cz/understand-server/files/"+e+".mp3",loadAudioToPlayer(audiofile),$from.val(t),$from.change()}function jumpBack(e){var t=player.currentTime;t>e?(player.currentTime=t-e,stored_audio_time=player.currentTime,localStorage.setItem("stored_audio_time",stored_audio_time)):(player.currentTime=0,stored_audio_time=0,localStorage.setItem("stored_audio_time",stored_audio_time))}function playPause(){stored_audio_time=player.currentTime,correct_knob_duration&&setTimeout(function(){player.duration&&(setKnob(player.duration,stored_audio_time),correct_knob_duration=0)},200),player.paused||player.ended?(player.play(),$play_btn.addClass("hidden"),$pause_btn.removeClass("hidden"),TRACK.addPauseTime(),document.getElementById("idle").style.color="#4ba3d9"):(player.pause(),$pause_btn.addClass("hidden"),$play_btn.removeClass("hidden"),localStorage.setItem("stored_audio_time",stored_audio_time),TRACK.startPauseTimer(),TRACK.storeTrackingData())}function controlsToBottom(){var e=0,t=$(window).height();e=$(window).width()<=1100?t-238:t-168,e>400&&$content_wrapper.css({height:e+"px"})}function getQueryVariable(e,t){for(var a=e.split("&"),o=0;o<a.length;o++){var r=a[o].split("=");if(r[0]==t)return r[1]}return!1}function noParams(){window.location.search.substring(1)&&history.replaceState({},"understand",location.href.split("?")[0])}var server="https://www.simplyeasy.cz/understand-server/",from=localStorage.getItem("stored_lang_from")||"es",to=localStorage.getItem("stored_lang_to")||"en",scrollposition=Number(localStorage.getItem("scrollposition"))||0,textfile=localStorage.getItem("stored_text_file_content")||0,audiofile=localStorage.getItem("stored_audio_file_url")||0,player=0,stored_audio_time=Number(localStorage.getItem("stored_audio_time"))||0,uploaded_file_id=localStorage.getItem("uploaded_file_id")||0,correct_knob_duration=0,$knob_player,$knob_today,$body,$audio_time,$session_time,$session_time_small,$ratio,$session_audio_ratio,$audio_time_total,$session_time_total,$i_am_done,$backhome,$higher_than_ever,$translatedword,$selectedword,$translations,$whentoolong,$play_btn,$pause_btn,$play_pause,$jumpback,$from,$to,$idle,$goal_today,$streak,$record_ratio,$previous_translated_words,$linktodict,$googletranslate,$textFileSelect,$audioFileSelect,$content,$content_wrapper,$instructions,$tracking,$videocover,$videoafter,$videoreplay,ui_loc={en:{day:"day",days:"days"},cs:{day:"den",days:"dnů"}},today=moment().format("YYYY-MM-DD"),allowed_idle=3e5,last_pause_time,pause_diff,data=JSON.parse(localStorage.getItem("data"))||{},TRACK={};TRACK.dataObjectExist=function(e){data[from]||(data[from]={total:{st:0,at:0,dg:1800,s:0,rr:0},days:{}}),data[from].days[e]||(data[from].days[e]={at:0,st:0,ga:0})},TRACK.setTodayKnob=function(){$goal_today.text(convertSeconds(data[from].total.dg)),$knob_today.trigger("configure",{max:data[from].total.dg}).val(data[from].days[today].st).trigger("change")},TRACK.displayTrackingData=function(e){$audio_time.text(convertSeconds(data[from].days[e].at));var t=convertSeconds(data[from].days[e].st);$session_time.text(t),$session_time_small.text(t);var a=calculateRatio(data[from].days[e].at,data[from].days[e].st);a>0?($session_audio_ratio.text(a),$ratio.height(1.7*a).removeClass("hidden")):$ratio.addClass("hidden"),$audio_time_total.text(convertSeconds(data[from].total.at)),$session_time_total.text(convertSeconds(data[from].total.st)),$knob_today.val(data[from].days[e].st).trigger("change"),data[from].days[e].ga?data[from].total.rr&&a>data[from].total.rr?$higher_than_ever.removeClass("hidden"):$higher_than_ever.addClass("hidden"):data[from].days[e].st>data[from].total.dg&&($i_am_done.removeClass("hidden"),$idle.html('<i class="fa fa-check-circle"></i>'),data[from].days[e].ga=1,TRACK.currentStreak())},TRACK.currentStreak=function(){var e=moment(today).subtract(1,"days").format("YYYY-MM-DD");"added"!==data[from].days[today].ga&&(data[from].days[today].ga?(data[from].total.s=data[from].days[e]&&data[from].days[e].ga?data[from].total.s+data[from].days[today].ga:1,data[from].days[today].ga="added",TRACK.storeTrackingData()):data[from].days[e]&&data[from].days[e].ga||(data[from].total.s=0)),$streak.text(1===data[from].total.s?data[from].total.s+" "+ui_loc[ui_lang].day:data[from].total.s+" "+ui_loc[ui_lang].days)},TRACK.ratioStats=function(){var e,t;for(e=1;31>e;e++)t=moment(today).subtract(e,"days").format("YYYY-MM-DD")||0,data[from].days[t]&&data[from].days[t].ga&&(data[from].days[t].r||(data[from].days[t].r=calculateRatio(data[from].days[t].at,data[from].days[t].st)),data[from].days[t].r>data[from].total.rr&&(data[from].total.rr=data[from].days[t].r));data[from].total.rr&&$record_ratio.text(data[from].total.rr+"%")},TRACK.storeTrackingData=function(){localStorage.setItem("data",JSON.stringify(data))},TRACK.addToDayAndTotal=function(e,t){data[from].days[today][t]=data[from].days[today][t]+e,data[from].total[t]=data[from].total[t]+e},deleteTrackingData=function(){localStorage.removeItem("data"),document.getElementById("delete").innerHTML="<br /><br />[ deleted ]"},TRACK.addAudioTime=function(e){e>-7&&1>e&&(e>0?(TRACK.addToDayAndTotal(e,"st"),TRACK.addToDayAndTotal(e,"at")):e&&data[from].days[today].at+e>0&&(TRACK.addToDayAndTotal(e,"at"),TRACK.displayTrackingData(today)))},TRACK.startPauseTimer=function(){last_pause_time=moment()},TRACK.addPauseTime=function(){last_pause_time&&(pause_diff=moment().diff(last_pause_time),allowed_idle>pause_diff&&TRACK.addToDayAndTotal(pause_diff/1e3,"st"))},TRACK.newDay=function(){today!==moment().format("YYYY-MM-DD")&&(today=moment().format("YYYY-MM-DD"),TRACK.dataObjectExist(today),$i_am_done.addClass("hidden"),$idle.html('<i class="fa fa-clock-o"></i>'),$ratio.addClass("hidden"),$higher_than_ever.addClass("hidden"),last_pause_time=0,TRACK.ratioStats(),TRACK.displayTrackingData(today),TRACK.currentStreak())};var previous_selection="";$(document).ready(function(){$body=$("html, body"),$audio_time=$("#audio_time"),$session_time=$("#session_time"),$session_time_small=$("#session_time_small"),$ratio=$("#ratio"),$session_audio_ratio=$("#session_audio_ratio"),$audio_time_total=$("#audio_time_total"),$session_time_total=$("#session_time_total"),$i_am_done=$("#i_am_done"),$idle=$("#idle"),$higher_than_ever=$("#higher_than_ever"),$translatedword=$("#translatedword"),$selectedword=$("#selectedword"),$translations=$("#translations"),$whentoolong=$("#whentoolong"),$play_btn=$("#play_btn"),$pause_btn=$("#pause_btn"),$play_pause=$("#play_pause"),$jumpback=$("#jumpback"),$from=$("#from"),$to=$("#to"),$backhome=$(".backhome"),$goal_today=$("#goal_today"),$streak=$("#streak"),$record_ratio=$("#record_ratio"),$previous_translated_words=$("#previous_translated_words"),$linktodict=$("#linktodict"),$googletranslate=$("#googletranslate"),$textFileSelect=$("#textFileSelect"),$audioFileSelect=$("#audioFileSelect"),$content=$("#content"),$content_wrapper=$("#content_wrapper"),$instructions=$("#instructions"),$tracking=$("#tracking"),$videocover=$("#videocover"),$videoafter=$("#videoafter"),$videoreplay=$("#videoreplay"),controlsToBottom(),window.addEventListener("orientationchange",function(){setTimeout(controlsToBottom,400)},!1);var e=$jumpback.data("jump");textfile?loadText(textfile):($instructions.removeClass("hidden"),$backhome.addClass("hidden")),$content.on("mouseup",function(e){var t=window.getSelection(),a=t.getRangeAt(0);if(0===t.toString().length&&$(e.target).is("span.mycontent")){for(var o=t.anchorNode;0!==a.toString().indexOf(" ");)a.setStart(o,a.startOffset-1);if(a.setStart(o,a.startOffset+1),a.endOffset<o.length){do a.setEnd(o,a.endOffset+1);while(-1===a.toString().indexOf(" "));a.setEnd(o,a.endOffset-1)}}var r=a.toString().trim();handleSelectedText(r)}),document.getElementById("content").addEventListener("copy",onCopyEvent),localStorage.getItem("stored_lang_to")||(to=ui_lang,$to.val(to),localStorage.getItem("stored_lang_from")||"en"===to||(from="en",$from.val("en"))),$from.val(from),$to.val(to),$from.change(function(){from=$(this).val(),TRACK.dataObjectExist(today),TRACK.setTodayKnob(),TRACK.displayTrackingData(today),localStorage.setItem("stored_lang_from",from)}),$to.change(function(){to=$(this).val(),localStorage.setItem("stored_lang_to",to)}),$(".knob").knob({change:function(e){player.currentTime=e}}),$knob_player=$("#knob_player"),$knob_today=$("#knob_today"),$knob_player.trigger("configure",{max:100}).val(0).trigger("change"),$play_pause.click(function(){audiofile?playPause():$videocover.is(":visible")&&$videocover.click()}),$jumpback.click(function(){jumpBack(e)});var t=document.getElementById("audio_files");t.addEventListener("change",handleAudioFileSelect,!1);var a=document.getElementById("audioFileSelect");a.addEventListener("click",function(e){t&&t.click(),e.preventDefault()},!1);var o=document.getElementById("text_files");o.addEventListener("change",handleTextFileSelect,!1);var r=document.getElementById("textFileSelect");r.addEventListener("click",function(e){o&&o.click(),e.preventDefault()},!1),audiofile&&loadAudioToPlayer(audiofile),$backhome.click(function(){resetPlayer(),resetText()});var n=window.location.search.substring(1);if(n){var d=getQueryVariable(n,"id"),i=getQueryVariable(n,"lang");d&&i&&loadDemo(d,i)}window.onkeyup=function(t){var a=t.keyCode?t.keyCode:t.which;37==a?jumpBack(e):39==a?audiofile&&playPause():16!=a||t.ctrlKey||t.metaKey||$(".helpcrunch-chat").is(":visible")||($googletranslate.is(":visible")?$googletranslate[0].click():$selectedword.text()&&$linktodict[0].click())};var s=$("#r").text();s=s.replace(" at ",String.fromCharCode(64)),s=s.replace(" dot ",String.fromCharCode(46)),$("#r").text(s),$(".jump_to").click(function(){var e=$(this).data("marker");$body.animate({scrollTop:$("#"+e).offset().top},1e3)}),TRACK.dataObjectExist(today),TRACK.setTodayKnob(),TRACK.displayTrackingData(today),data[from].days[today].ga&&($i_am_done.removeClass("hidden"),$idle.html('<i class="fa fa-check-circle"></i>')),TRACK.currentStreak(),TRACK.ratioStats();setInterval(function(){player.paused||player.ended?(last_pause_time&&moment().diff(last_pause_time)>allowed_idle&&(document.getElementById("idle").style.color="#d7d7d7"),TRACK.newDay()):TRACK.displayTrackingData(today)},1e3);$idle.click(function(){$body.animate({scrollTop:$tracking[0].scrollHeight+($tracking.offset().top-$(window).height())})}),$("#minus").click(function(){data[from].total.dg>900&&(data[from].total.dg=data[from].total.dg-900,TRACK.setTodayKnob(),TRACK.storeTrackingData())}),$("#plus").click(function(){data[from].total.dg=data[from].total.dg+900,TRACK.setTodayKnob(),TRACK.storeTrackingData()});var l=document.getElementById("videofile");$videocover.click(function(){$videocover.addClass("hidden"),l.paused||l.ended?l.play():l.pause(),l.addEventListener("ended",function(){$videoafter.removeClass("hidden")})}),$videoreplay.click(function(){$videoafter.addClass("hidden"),$videocover.click()}),function(e,t,a,o,r,n){e.hj=e.hj||function(){(e.hj.q=e.hj.q||[]).push(arguments)},e._hjSettings={hjid:79605,hjsv:5},r=t.getElementsByTagName("head")[0],n=t.createElement("script"),n.async=1,n.src=a+e._hjSettings.hjid+o+e._hjSettings.hjsv,r.appendChild(n)}(window,document,"//static.hotjar.com/c/hotjar-",".js?sv=");var c={applicationId:117,applicationSecret:"kIpJ1ACkWUz2f8fR1drIfrTBRX1jVZRMdjSDmkPX+x8hciZvIvflfGXFa8zfg8D9aoHTPGDCsD0+F9V8I2xRiQ=="};uploaded_file_id&&(c.user={user_id:uploaded_file_id}),function(e,t){e.HelpCrunch=function(){e.HelpCrunch.q.push(arguments)},e.HelpCrunch.q=[];var a=document.createElement("script");a.async=1,a.type="text/javascript",a.src="https://honzzz.helpcrunch.com/compiled/sdk.js",t.body.appendChild(a)}(window,document),HelpCrunch("init","honzzz",c),HelpCrunch("showChatWidget",{position:"right"})});