function convertSeconds(t){var e,a,o,r,n="0 min";return t>0&&(e=moment.duration(t,"seconds"),o=e.hours(),a=e.days(),o||a?(o+=24*a,o+=" h "):o="",r=e.minutes()||"",(r||!o)&&(r=e.minutes()+" min"),n=o+r),n}function calculateRatio(t,e){return t&&e?Math.floor(t/e*100):"-"}function errorHandler(t){console.log("error>",t.message)}function linkToDict(t){return"cs"!==to||"en"!==from&&"es"!==from&&"de"!==from&&"fr"!==from&&"it"!==from&&"ru"!==from?"https://translate.google.com/#"+from+"/"+to+"/"+encodeURIComponent(t):"http://slovnik.seznam.cz/"+from+"-cz/word/?q="+encodeURIComponent(t)}function prependPrevWord(t){$previous_translated_words.prepend('<p><a target="_blank" href="'+linkToDict(t[from])+'"><span>'+t[from]+"</span>&nbsp;&nbsp;"+t[to]+" <em>></em></a></p>")}function mycallback(t){$translatedword.text(t)}function callBing(t,e,a){$.ajax({type:"POST",data:{authtype:"js"},url:server+"token.php",success:function(o){var r=document.createElement("script");r.src="https://api.microsofttranslator.com/V2/Ajax.svc/Translate?appId=Bearer "+encodeURIComponent(o)+"&from="+encodeURIComponent(t)+"&to="+encodeURIComponent(e)+"&text="+encodeURIComponent(a)+"&oncomplete=mycallback",document.body.appendChild(r)},error:function(){console.log("bing translator error"),$translatedword.text("ERROR")}})}function getTextSelection(){return window.getSelection?window.getSelection().toString():document.getSelection?document.getSelection().toString():document.selection?document.selection.createRange().text:""}function onCopyEvent(){handleSelectedText(getTextSelection())}function handleSelectedText(t){if(!t||previous_selection===t)return!1;previous_selection=t;var e={};return e[from]=$selectedword.text(),e[to]=$translatedword.text(),t=t.trim(),t.split(" ").length<=1?($translatedword.text("..."),t=t.replace(/^[,.?¿!¡:();„“”‚‘'’"‹›«»—]+|[,.?¿!¡:();„“”‚‘'’"‹›«»—]+$/g,""),$whentoolong.addClass("hidden"),$selectedword.text(t),callBing(from,to,t),$translations.removeClass("hidden"),$linktodict.attr("href",linkToDict(t))):($googletranslate.attr("href","https://translate.google.com/#"+from+"/"+to+"/"+encodeURIComponent(t)),$translations.addClass("hidden"),$whentoolong.removeClass("hidden"),$translatedword.text("...")),$previous_translated_words.is(":visible")&&"..."!==e[to]&&"ERROR"!==e[to]&&prependPrevWord(e),!0}function setKnob(t,e){var a=e||stored_audio_time;$knob_player.trigger("configure",{max:t}).val(a).trigger("change")}function loadAudioToPlayer(t){player=new Audio(t),$audioFileSelect.css({"background-color":"#FFFFFF",color:"#565656"});var e=0;player.oncanplay=function(){e||($play_pause.css("color","#4ba3d9"),player.duration?(player.currentTime=stored_audio_time,setKnob(player.duration,stored_audio_time)):correct_knob_duration=1,e=1)};var a=0,o=stored_audio_time;player.ontimeupdate=function(){0===player.currentTime&&stored_audio_time&&(player.currentTime=stored_audio_time+a),$knob_player.val(player.currentTime).trigger("change"),a=player.currentTime-o,o=player.currentTime,TRACK.addAudioTime(a)},player.onended=function(){$pause_btn.addClass("hidden"),$play_btn.removeClass("hidden")}}function resetPlayer(){!player||player.paused||player.ended||player.pause(),stored_audio_time=0,localStorage.setItem("stored_audio_time",stored_audio_time),audiofile=0,localStorage.removeItem("stored_audio_file_url"),$pause_btn.addClass("hidden"),$play_btn.removeClass("hidden"),$knob_player.val(0).trigger("change"),$play_pause.css("color","#AEAEAE"),$audioFileSelect.css({"background-color":"#4ba3d9",color:"#ffffff"})}function resetText(){$backhome.addClass("hidden"),$content.addClass("hidden").text(""),$instructions.removeClass("hidden"),scrollposition=0,localStorage.setItem("scrollposition",scrollposition),localStorage.removeItem("stored_text_file_content"),$textFileSelect.css({"background-color":"#4ba3d9",color:"#ffffff"}),noParams()}function handleAudioFileSelect(t){resetPlayer(),noParams(),audiofile=t.target.files[0],loadAudioToPlayer(URL.createObjectURL(audiofile));var e=function(t){return"audio"===t.type.substring(0,5)&&"mp3"===t.name.substr(t.name.length-3)?!0:!1};if(audiofile.size<103809024&&e(audiofile)){var a=new FormData($("form")[0]);uploaded_file_id&&a.append("previous",uploaded_file_id),$.ajax({url:server+"upload.php",type:"POST",success:function(t){"Sorry"!==t.substring(0,5)&&(t=$.trim(t),localStorage.setItem("uploaded_file_id",t),localStorage.setItem("stored_audio_file_url",server+"uploads/"+t+".mp3"))},error:function(t){console.log("error: ",t)},data:a,cache:!1,contentType:!1,processData:!1})}}function loadText(t){$instructions.addClass("hidden"),$textFileSelect.css({"background-color":"#FFFFFF",color:"#565656"});for(var e=t.split("\n"),a='<p><span class="mycontent"> ',o=0,r=e.length;r>o;o++)"\r"!==e[o]&&""!==e[o]?a=a+e[o]+" ":a+='</span></p><p><span class="mycontent"> ';a+="</span></p>",$backhome.removeClass("hidden"),$content.removeClass("hidden").html(a),$content_wrapper.scrollTop(scrollposition),$content_wrapper.scroll(function(){localStorage.setItem("scrollposition",this.scrollTop)})}function handleTextFileSelect(t){if("txt"===t.target.files[0].name.substr(t.target.files[0].name.length-3)&&"text"===t.target.files[0].type.substring(0,4))if(scrollposition=0,localStorage.setItem("scrollposition",scrollposition),window.FileReader){var e=new FileReader;e.onload=function(t){loadText(t.target.result),localStorage.setItem("stored_text_file_content",t.target.result),"function"==typeof hj&&hj("vpv","/app/text-loaded/")},e.readAsText(t.target.files[0])}else console.log("File reader not supported.");else console.log("This is not a text file!")}function loadDemo(t,e){$instructions.addClass("hidden"),resetPlayer(),$.get("../demo/"+t+".txt",function(t){loadText(t)}),audiofile="https://www.simplyeasy.cz/understand-server/files/"+t+".mp3",loadAudioToPlayer(audiofile),$from.val(e),$from.change()}function jumpBack(t){var e=player.currentTime;e>t?(player.currentTime=e-t,stored_audio_time=player.currentTime,localStorage.setItem("stored_audio_time",stored_audio_time)):(player.currentTime=0,stored_audio_time=0,localStorage.setItem("stored_audio_time",stored_audio_time))}function playPause(){stored_audio_time=player.currentTime,correct_knob_duration&&setTimeout(function(){player.duration&&(setKnob(player.duration,stored_audio_time),correct_knob_duration=0)},200),player.paused||player.ended?(player.play(),$play_btn.addClass("hidden"),$pause_btn.removeClass("hidden"),TRACK.addPauseTime(),document.getElementById("idle").style.color="#4ba3d9"):(player.pause(),$pause_btn.addClass("hidden"),$play_btn.removeClass("hidden"),localStorage.setItem("stored_audio_time",stored_audio_time),TRACK.startPauseTimer(),TRACK.storeTrackingData())}function controlsToBottom(){var t=0,e=$(window).height();t=$(window).width()<=1100?e-238:e-168,t>400&&$content_wrapper.css({height:t+"px"})}function getQueryVariable(t,e){for(var a=t.split("&"),o=0;o<a.length;o++){var r=a[o].split("=");if(r[0]==e)return r[1]}return!1}function noParams(){window.location.search.substring(1)&&history.replaceState({},"understand",location.href.split("?")[0])}var server="https://www.simplyeasy.cz/understand-server/",from=localStorage.getItem("stored_lang_from")||"es",to=localStorage.getItem("stored_lang_to")||"en",scrollposition=Number(localStorage.getItem("scrollposition"))||0,textfile=localStorage.getItem("stored_text_file_content")||0,audiofile=localStorage.getItem("stored_audio_file_url")||0,player=0,stored_audio_time=Number(localStorage.getItem("stored_audio_time"))||0,uploaded_file_id=localStorage.getItem("uploaded_file_id")||0,correct_knob_duration=0,$knob_player,$knob_today,$body,$audio_time,$session_time,$session_time_small,$ratio,$session_audio_ratio,$audio_time_total,$session_time_total,$i_am_done,$backhome,$higher_than_ever,$translatedword,$selectedword,$translations,$whentoolong,$play_btn,$pause_btn,$play_pause,$jumpback,$from,$to,$idle,$goal_today,$streak,$record_ratio,$previous_translated_words,$linktodict,$googletranslate,$textFileSelect,$audioFileSelect,$content,$content_wrapper,$instructions,$tracking,ui_loc={en:{day:"day",days:"days"},cs:{day:"den",days:"dnů"}},today=moment().format("YYYY-MM-DD"),allowed_idle=3e5,last_pause_time,pause_diff,data=JSON.parse(localStorage.getItem("data"))||{},TRACK={};TRACK.dataObjectExist=function(t){data[from]||(data[from]={total:{st:0,at:0,dg:1800,s:0,rr:0},days:{}}),data[from].days[t]||(data[from].days[t]={at:0,st:0,ga:0})},TRACK.setTodayKnob=function(){$goal_today.text(convertSeconds(data[from].total.dg)),$knob_today.trigger("configure",{max:data[from].total.dg}).val(data[from].days[today].st).trigger("change")},TRACK.displayTrackingData=function(t){$audio_time.text(convertSeconds(data[from].days[t].at));var e=convertSeconds(data[from].days[t].st);$session_time.text(e),$session_time_small.text(e);var a=calculateRatio(data[from].days[t].at,data[from].days[t].st);a>0?($session_audio_ratio.text(a),$ratio.height(1.7*a).removeClass("hidden")):$ratio.addClass("hidden"),$audio_time_total.text(convertSeconds(data[from].total.at)),$session_time_total.text(convertSeconds(data[from].total.st)),$knob_today.val(data[from].days[t].st).trigger("change"),data[from].days[t].ga?data[from].total.rr&&a>data[from].total.rr?$higher_than_ever.removeClass("hidden"):$higher_than_ever.addClass("hidden"):data[from].days[t].st>data[from].total.dg&&($i_am_done.removeClass("hidden"),$idle.html('<i class="fa fa-check-circle"></i>'),data[from].days[t].ga=1,TRACK.currentStreak())},TRACK.currentStreak=function(){var t=moment(today).subtract(1,"days").format("YYYY-MM-DD");"added"!==data[from].days[today].ga&&(data[from].days[today].ga?(data[from].total.s=data[from].days[t]&&data[from].days[t].ga?data[from].total.s+data[from].days[today].ga:1,data[from].days[today].ga="added",TRACK.storeTrackingData()):data[from].days[t]&&data[from].days[t].ga||(data[from].total.s=0)),$streak.text(1===data[from].total.s?data[from].total.s+" "+ui_loc[ui_lang].day:data[from].total.s+" "+ui_loc[ui_lang].days)},TRACK.ratioStats=function(){var t,e;for(t=1;31>t;t++)e=moment(today).subtract(t,"days").format("YYYY-MM-DD")||0,data[from].days[e]&&data[from].days[e].ga&&(data[from].days[e].r||(data[from].days[e].r=calculateRatio(data[from].days[e].at,data[from].days[e].st)),data[from].days[e].r>data[from].total.rr&&(data[from].total.rr=data[from].days[e].r));data[from].total.rr&&$record_ratio.text(data[from].total.rr+"%")},TRACK.storeTrackingData=function(){localStorage.setItem("data",JSON.stringify(data))},TRACK.addToDayAndTotal=function(t,e){data[from].days[today][e]=data[from].days[today][e]+t,data[from].total[e]=data[from].total[e]+t},deleteTrackingData=function(){localStorage.removeItem("data"),document.getElementById("delete").innerHTML="<br /><br />[ deleted ]"},TRACK.addAudioTime=function(t){t>-7&&1>t&&(t>0?(TRACK.addToDayAndTotal(t,"st"),TRACK.addToDayAndTotal(t,"at")):t&&data[from].days[today].at+t>0&&(TRACK.addToDayAndTotal(t,"at"),TRACK.displayTrackingData(today)))},TRACK.startPauseTimer=function(){last_pause_time=moment()},TRACK.addPauseTime=function(){last_pause_time&&(pause_diff=moment().diff(last_pause_time),allowed_idle>pause_diff&&TRACK.addToDayAndTotal(pause_diff/1e3,"st"))},TRACK.newDay=function(){today!==moment().format("YYYY-MM-DD")&&(today=moment().format("YYYY-MM-DD"),TRACK.dataObjectExist(today),$i_am_done.addClass("hidden"),$idle.html('<i class="fa fa-clock-o"></i>'),$ratio.addClass("hidden"),$higher_than_ever.addClass("hidden"),last_pause_time=0,TRACK.ratioStats(),TRACK.displayTrackingData(today),TRACK.currentStreak())};var previous_selection="";$(document).ready(function(){$body=$("html, body"),$audio_time=$("#audio_time"),$session_time=$("#session_time"),$session_time_small=$("#session_time_small"),$ratio=$("#ratio"),$session_audio_ratio=$("#session_audio_ratio"),$audio_time_total=$("#audio_time_total"),$session_time_total=$("#session_time_total"),$i_am_done=$("#i_am_done"),$idle=$("#idle"),$higher_than_ever=$("#higher_than_ever"),$translatedword=$("#translatedword"),$selectedword=$("#selectedword"),$translations=$("#translations"),$whentoolong=$("#whentoolong"),$play_btn=$("#play_btn"),$pause_btn=$("#pause_btn"),$play_pause=$("#play_pause"),$jumpback=$("#jumpback"),$from=$("#from"),$to=$("#to"),$backhome=$(".backhome"),$goal_today=$("#goal_today"),$streak=$("#streak"),$record_ratio=$("#record_ratio"),$previous_translated_words=$("#previous_translated_words"),$linktodict=$("#linktodict"),$googletranslate=$("#googletranslate"),$textFileSelect=$("#textFileSelect"),$audioFileSelect=$("#audioFileSelect"),$content=$("#content"),$content_wrapper=$("#content_wrapper"),$instructions=$("#instructions"),$tracking=$("#tracking"),controlsToBottom(),window.addEventListener("orientationchange",function(){setTimeout(controlsToBottom,400)},!1);var t=$jumpback.data("jump");textfile?loadText(textfile):($instructions.removeClass("hidden"),$backhome.addClass("hidden")),$content.on("mouseup",function(t){var e=window.getSelection(),a=e.getRangeAt(0);if(0===e.toString().length&&$(t.target).is("span.mycontent")){for(var o=e.anchorNode;0!==a.toString().indexOf(" ");)a.setStart(o,a.startOffset-1);if(a.setStart(o,a.startOffset+1),a.endOffset<o.length){do a.setEnd(o,a.endOffset+1);while(-1===a.toString().indexOf(" "));a.setEnd(o,a.endOffset-1)}}var r=a.toString().trim();handleSelectedText(r)}),document.getElementById("content").addEventListener("copy",onCopyEvent),localStorage.getItem("stored_lang_to")||(to=ui_lang,$to.val(to),localStorage.getItem("stored_lang_from")||"en"===to||(from="en",$from.val("en"))),$from.val(from),$to.val(to),$from.change(function(){from=$(this).val(),TRACK.dataObjectExist(today),TRACK.setTodayKnob(),TRACK.displayTrackingData(today),localStorage.setItem("stored_lang_from",from)}),$to.change(function(){to=$(this).val(),localStorage.setItem("stored_lang_to",to)}),$(".knob").knob({change:function(t){player.currentTime=t}}),$knob_player=$("#knob_player"),$knob_today=$("#knob_today"),$knob_player.trigger("configure",{max:100}).val(0).trigger("change"),$play_pause.click(function(){audiofile&&playPause()}),$jumpback.click(function(){jumpBack(t)});var e=document.getElementById("audio_files");e.addEventListener("change",handleAudioFileSelect,!1);var a=document.getElementById("audioFileSelect");a.addEventListener("click",function(t){e&&e.click(),t.preventDefault()},!1);var o=document.getElementById("text_files");o.addEventListener("change",handleTextFileSelect,!1);var r=document.getElementById("textFileSelect");r.addEventListener("click",function(t){o&&o.click(),t.preventDefault()},!1),audiofile&&loadAudioToPlayer(audiofile),$backhome.click(function(){resetPlayer(),resetText()});var n=window.location.search.substring(1);if(n){var d=getQueryVariable(n,"id"),i=getQueryVariable(n,"lang");d&&i&&loadDemo(d,i)}window.onkeyup=function(e){var a=e.keyCode?e.keyCode:e.which;37==a?jumpBack(t):39==a?playPause():16!=a||e.ctrlKey||e.metaKey||$(".helpcrunch-chat").is(":visible")||($googletranslate.is(":visible")?$googletranslate[0].click():$selectedword.text()&&$linktodict[0].click())};var s=$("#r").text();s=s.replace(" at ",String.fromCharCode(64)),s=s.replace(" dot ",String.fromCharCode(46)),$("#r").text(s),$(".jump_to").click(function(){var t=$(this).data("marker");$body.animate({scrollTop:$("#"+t).offset().top},1e3),"function"==typeof hj&&"faq"===t&&hj("vpv","/app/instructions")}),TRACK.dataObjectExist(today),TRACK.setTodayKnob(),TRACK.displayTrackingData(today),data[from].days[today].ga&&($i_am_done.removeClass("hidden"),$idle.html('<i class="fa fa-check-circle"></i>')),TRACK.currentStreak(),TRACK.ratioStats();setInterval(function(){player.paused||player.ended?(last_pause_time&&moment().diff(last_pause_time)>allowed_idle&&(document.getElementById("idle").style.color="#d7d7d7"),TRACK.newDay()):TRACK.displayTrackingData(today)},1e3);$idle.click(function(){$body.animate({scrollTop:$tracking[0].scrollHeight+($tracking.offset().top-$(window).height())})}),$("#minus").click(function(){data[from].total.dg>900&&(data[from].total.dg=data[from].total.dg-900,TRACK.setTodayKnob(),TRACK.storeTrackingData())}),$("#plus").click(function(){data[from].total.dg=data[from].total.dg+900,TRACK.setTodayKnob(),TRACK.storeTrackingData()}),function(t,e,a,o,r,n){t.hj=t.hj||function(){(t.hj.q=t.hj.q||[]).push(arguments)},t._hjSettings={hjid:79605,hjsv:5},r=e.getElementsByTagName("head")[0],n=e.createElement("script"),n.async=1,n.src=a+t._hjSettings.hjid+o+t._hjSettings.hjsv,r.appendChild(n)}(window,document,"//static.hotjar.com/c/hotjar-",".js?sv=");var l={applicationId:117,applicationSecret:"kIpJ1ACkWUz2f8fR1drIfrTBRX1jVZRMdjSDmkPX+x8hciZvIvflfGXFa8zfg8D9aoHTPGDCsD0+F9V8I2xRiQ=="};uploaded_file_id&&(l.user={user_id:uploaded_file_id}),function(t,e){t.HelpCrunch=function(){t.HelpCrunch.q.push(arguments)},t.HelpCrunch.q=[];var a=document.createElement("script");a.async=1,a.type="text/javascript",a.src="https://honzzz.helpcrunch.com/compiled/sdk.js",e.body.appendChild(a)}(window,document),HelpCrunch("init","honzzz",l),HelpCrunch("showChatWidget",{position:"right"})});